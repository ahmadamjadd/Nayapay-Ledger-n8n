{
  "name": "My workflow",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "nayapay-sync",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        0,
        0
      ],
      "id": "3792388b-5d22-496b-8019-22656008fb86",
      "name": "Webhook",
      "webhookId": "49affd88-3373-48b4-91cb-d1a75dc280a2"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "messages": {
          "values": [
            {
              "content": "You are a financial data extraction expert. Your goal is to process NayaPay transaction notifications into a clean JSON format for automated bookkeeping.\n\n### Rules:\n1. Extract the \"Amount\" as a clean number (remove \"Rs.\", \"PKR\", and all commas).\n2. Extract the \"Recipient\" or \"Merchant\" name.\n3. Determine the \"Transaction_Type\" (e.g., Sent, Received, or Bill Payment).\n4. Extract the \"Time\" if provided.\n5. Output MUST be strictly valid JSON only. \n6. Do not include markdown code blocks (like ```json), explanations, or notes.",
              "role": "model"
            },
            {
              "content": "=Extract the financial details from this NayaPay notification:\n\nMessage: \"{{ $json.body.message }}\"\nTime: \"{{ $json.body.time }}\"\n\nReturn the data in this exact structure:\n{\n  \"amount\": 0,\n  \"recipient\": \"name\",\n  \"type\": \"type\",\n  \"time\": \"hour:minute\"\n}"
            }
          ]
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1.1,
      "position": [
        224,
        0
      ],
      "id": "bcd43187-d299-4f1e-aa9e-651a6aec599c",
      "name": "Message a model",
      "credentials": {
        "googlePalmApi": {
          "id": "X5jYxGj4IFmYD1gp",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    }
  ],
  "pinData": {
    "Webhook": [
      {
        "json": {
          "headers": {
            "user-agent": "macrodroid/5.60.9",
            "content-type": "application/json; charset=utf-8",
            "content-length": "138",
            "host": "192.168.1.6:5678",
            "connection": "Keep-Alive",
            "accept-encoding": "gzip"
          },
          "params": {},
          "query": {},
          "body": {
            "message": "Rs. 1 sent to Muhammad Ahmed Amjad. Your walletâ€™s seen better days.",
            "title": "Off it goes ðŸ’¸",
            "time": "13:32"
          },
          "webhookUrl": "http://localhost:5678/webhook-test/nayapay-sync",
          "executionMode": "test"
        },
        "pairedItem": {
          "item": 0
        }
      }
    ],
    "Message a model": [
      {
        "json": {
          "content": {
            "parts": [
              {
                "text": "{\"amount\": 1, \"recipient\": \"Muhammad Ahmed Amjad\", \"type\": \"Sent\", \"time\": \"13:32\"}"
              }
            ],
            "role": "model"
          },
          "finishReason": "STOP",
          "index": 0
        },
        "pairedItem": {
          "item": 0
        }
      }
    ]
  },
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Message a model",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "69302493-dd1a-4d5a-872e-fc32636317f8",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "4ab2b104b33744732db6e5605c6b2ff26da2cb69f5bec97d8de9d94bdcf5b93d"
  },
  "id": "5mJTGPLTAQo90Txof6_0L",
  "tags": []
}
# NayaPay Ledger - Automated Expense Tracker

Automatically log NayaPay transactions to Google Sheets using AI-powered data extraction.

## ğŸ¯ Overview

This project automates the process of tracking NayaPay transactions by:
1. Receiving SMS notifications from your phone via webhook
2. Using Google Gemini AI to extract structured data from the SMS
3. Storing the parsed transaction data in Google Sheets

## ğŸ“¸ Workflow

![Workflow](workflow.png)

## ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Phone     â”‚     â”‚   n8n       â”‚     â”‚   Gemini    â”‚     â”‚   Google    â”‚
â”‚  (MacroDroid)â”‚â”€â”€â”€â”€â–ºâ”‚  Webhook    â”‚â”€â”€â”€â”€â–ºâ”‚   AI        â”‚â”€â”€â”€â”€â–ºâ”‚   Sheets    â”‚
â”‚             â”‚     â”‚   (EC2)     â”‚     â”‚             â”‚     â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ Tech Stack

| Component | Technology |
|-----------|------------|
| Workflow Engine | n8n (Docker) |
| Infrastructure | AWS EC2 (t3.micro) |
| IaC | Terraform |
| AI Model | Google Gemini 2.5 Flash |
| Storage | Google Sheets |
| Trigger | MacroDroid / Tasker (Android) |

## ğŸ“ Project Structure

```
Nayapay-Ledger/
â”œâ”€â”€ main.tf                 # Terraform infrastructure config
â”œâ”€â”€ Nayapay-Ledger.json     # n8n workflow export
â”œâ”€â”€ .gitignore              # Git ignore rules
â””â”€â”€ README.md               # This file
```

## ğŸš€ Deployment

### Prerequisites

- AWS Account with IAM credentials configured
- Terraform installed
- Google Cloud Project with:
  - Gemini API enabled
  - Google Sheets API enabled

### Step 1: Deploy Infrastructure

```bash
# Initialize Terraform
terraform init

# Preview changes
terraform plan

# Deploy EC2 instance with n8n
terraform apply
```

After deployment, Terraform outputs:
- `n8n_public_ip` - Your n8n instance IP
- `n8n_url` - Direct link to n8n interface
- `ssh_command` - Ready-to-use SSH command

### Step 2: Access n8n

```
http://<your-ec2-ip>:5678
```

Or use nip.io for OAuth compatibility:
```
http://<your-ec2-ip>.nip.io:5678
```

### Step 3: Import Workflow

1. Open n8n web interface
2. Go to **Workflows** â†’ **Import from File**
3. Upload `Nayapay-Ledger.json`

### Step 4: Configure Credentials

Set up the following credentials in n8n:

| Credential | Type | Notes |
|------------|------|-------|
| Google Gemini | API Key | From Google AI Studio |
| Google Sheets | Service Account | Share sheet with service account email |

### Step 5: Configure Phone Automation

Use **MacroDroid** or **Tasker** on Android:

**Trigger:** SMS Received containing "NayaPay"

**Action:** HTTP POST to:
```
http://<your-ec2-ip>:5678/webhook/nayapay-sync
```

**Body (JSON):**
```json
{
  "message": "[SMS_TEXT]",
  "time": "[TIME]"
}
```

## ğŸ“Š Workflow Nodes

| Node | Function |
|------|----------|
| **Webhook** | Receives POST data from phone |
| **Message a Model** | Gemini AI extracts transaction details |
| **Edit Fields** | Parses JSON response |
| **Append Row in Sheet** | Saves to Google Sheets |

## ğŸ”§ Environment Variables

The n8n container uses these environment variables:

```bash
N8N_SECURE_COOKIE=false          # Allow HTTP access
WEBHOOK_URL=http://<ip>.nip.io:5678/  # Public webhook URL
```

## ğŸ“ Sample Data Flow

**Input SMS:**
```
You have sent Rs. 5,000 to Ahmed Ali via NayaPay at 14:30
```

**AI Extracted Output:**
```json
{
  "amount": 5000,
  "recipient": "Ahmed Ali",
  "type": "Sent",
  "time": "14:30"
}
```

**Google Sheet Entry:**
| Amount | Recipient | Type | Time |
|--------|-----------|------|------|
| 5000 | Ahmed Ali | Sent | 14:30 |

## ğŸ” Security Notes

- SSH key is auto-generated by Terraform (saved as `nayapay-n8n-key.pem`)
- Never commit `.pem` files or `.tfstate` to git
- For production, set up HTTPS with a proper domain
- Consider restricting SSH access to your IP in the security group

## ğŸ§¹ Cleanup

To destroy all AWS resources:

```bash
terraform destroy
```

## ğŸ“„ License

MIT

## ğŸ¤ Contributing

Feel free to open issues or submit PRs!

---

Built with â¤ï¸ using n8n, Terraform, and Google AI
